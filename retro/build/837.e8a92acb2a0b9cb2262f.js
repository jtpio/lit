"use strict";(self.webpackChunk_JUPYTERLAB_CORE_OUTPUT=self.webpackChunk_JUPYTERLAB_CORE_OUTPUT||[]).push([[837],{60837:(t,e,n)=>{n.r(e),n.d(e,{default:()=>_});var a=n(5768);const i=new(n(93315).Token)("@jupyterlite/contents:IContents");var o=n(75486),s=n.n(o);const r="JupyterLite Storage",c=new Set(["application/javascript","application/json","application/manifest+json","application/x-python-code","application/xml","image/svg+xml"]);class l{constructor(t){this._serverContents=new Map,this._storageName=r,this._storageName=(t||{}).contentsStorageName||r,this._storage=this.createDefaultStorage(),this._counters=this.createDefaultCounters(),this._checkpoints=this.createDefaultCheckpoints()}createDefaultStorage(){return s().createInstance({name:this._storageName,description:"Offline Storage for Notebooks and Files",storeName:"files",version:1})}createDefaultCounters(){return s().createInstance({name:this._storageName,description:"Store the current file suffix counters",storeName:"counters",version:1})}createDefaultCheckpoints(){return s().createInstance({name:this._storageName,description:"Offline Storage for Checkpoints",storeName:"checkpoints",version:1})}async newUntitled(t){var e,n,i;const o=null!==(e=null==t?void 0:t.path)&&void 0!==e?e:"",s=null!==(n=null==t?void 0:t.type)&&void 0!==n?n:"notebook",r=(new Date).toISOString();let c=a.PathExt.dirname(o);const l=a.PathExt.basename(o),p=a.PathExt.extname(o),h=await this.get(c);let d,f="";switch(o&&!p&&h?(c=`${o}/`,f=""):c&&l?(c=`${c}/`,f=l):(c="",f=o),s){case"directory":f=`Untitled Folder${await this._incrementCounter("directory")||""}`,d={name:f,path:`${c}${f}`,last_modified:r,created:r,format:"text",mimetype:"",content:null,size:void 0,writable:!0,type:"directory"};break;case"file":{const e=null!==(i=null==t?void 0:t.ext)&&void 0!==i?i:".txt",n=await this._incrementCounter("file");f=f||`untitled${n||""}${e}`,d={name:f,path:`${c}${f}`,last_modified:r,created:r,format:"text",mimetype:"text/plain",content:"",size:0,writable:!0,type:"file"};break}default:{const t=await this._incrementCounter("notebook");f=f||`Untitled${t||""}.ipynb`,d={name:f,path:`${c}${f}`,last_modified:r,created:r,format:"json",mimetype:"application/json",content:m.EMPTY_NB,size:JSON.stringify(m.EMPTY_NB).length,writable:!0,type:"notebook"};break}}const u=d.path;return await this._storage.setItem(u,d),d}async copy(t,e){let n=a.PathExt.basename(t);for(e=""===e?"":`${e.slice(1)}/`;await this.get(`${e}${n}`,{content:!0});){const t=a.PathExt.extname(n),e=n.replace(t,"");n=`${e} (copy)${t}`}const i=`${e}${n}`;let o=await this.get(t,{content:!0});if(!o)throw Error(`Could not find file with path ${t}`);return o={...o,name:n,path:i},await this._storage.setItem(i,o),o}async get(t,e){if(""===(t=decodeURIComponent(t.replace(/^\//,""))))return await this._getFolder(t);const n=await this._storage.getItem(t),i=await this._getServerContents(t,e),o=n||i;if(!o)return null;if(!(null==e?void 0:e.content))return{...o,content:null,size:void 0};if("directory"===o.type){const e=new Map;await this._storage.iterate(((n,a)=>{const i=n;a===`${t}/${i.name}`&&e.set(i.name,i)}));const n=i?i.content:Array.from((await this._getServerDirectory(t)).values());for(const t of n)e.has(t.name)||e.set(t.name,t);const s=[...e.values()];return{name:a.PathExt.basename(t),path:t,last_modified:o.last_modified,created:o.created,format:"json",mimetype:"application/json",content:s,size:void 0,writable:!0,type:"directory"}}return o}async rename(t,e){const n=decodeURIComponent(t),i=await this.get(n,{content:!0});if(!i)throw Error(`Could not find file with path ${n}`);const o=(new Date).toISOString(),s=a.PathExt.basename(e),r={...i,name:s,path:e,last_modified:o};if(await this._storage.setItem(e,r),await this._storage.removeItem(n),await this._checkpoints.removeItem(n),"directory"===i.type){let n;for(n of i.content)await this.rename(a.URLExt.join(t,n.name),a.URLExt.join(e,n.name))}return r}async save(t,e={}){var n;t=decodeURIComponent(t);let i=await this.get(t)||await this.newUntitled({path:t});if(!i)return null;const o=(new Date).toISOString();i={...i,...e,last_modified:o};const s=a.PathExt.extname(null!==(n=e.name)&&void 0!==n?n:"");if(e.content&&"base64"===e.format){const t=atob(e.content),n=".ipynb"===s;i={...i,content:n?JSON.parse(t):t,format:n?"json":"text",type:n?"notebook":"file"}}return await this._storage.setItem(t,i),i}async delete(t){t=decodeURIComponent(t);const e=[];await this._storage.iterate(((n,a)=>{(a===t||a.startsWith(`${t}/`))&&e.push(a)})),await Promise.all(e.map((async t=>Promise.all([this._storage.removeItem(t),this._checkpoints.removeItem(t)]))))}async createCheckpoint(t){var e;t=decodeURIComponent(t);const n=await this.get(t,{content:!0});if(!n)throw Error(`Could not find file with path ${t}`);const a=(null!==(e=await this._checkpoints.getItem(t))&&void 0!==e?e:[]).filter((t=>!!t));return a.push(n),a.length>5&&a.splice(0,a.length-5),await this._checkpoints.setItem(t,a),{id:""+(a.length-1),last_modified:n.last_modified}}async listCheckpoints(t){return(await this._checkpoints.getItem(t)||[]).filter((t=>!!t)).map(((t,e)=>({id:e.toString(),last_modified:t.last_modified})))}async restoreCheckpoint(t,e){t=decodeURIComponent(t);const n=(await this._checkpoints.getItem(t)||[])[parseInt(e)];await this._storage.setItem(t,n)}async deleteCheckpoint(t,e){t=decodeURIComponent(t);const n=await this._checkpoints.getItem(t)||[],a=parseInt(e);n.splice(a,1),await this._checkpoints.setItem(t,n)}async _getFolder(t){const e=new Map;await this._storage.iterate(((t,n)=>{if(n.includes("/"))return;const a=t;e.set(a.path,a)}));for(const n of(await this._getServerDirectory(t)).values())e.has(n.path)||e.set(n.path,n);return t&&0===e.size?null:{name:"",path:t,last_modified:new Date(0).toISOString(),created:new Date(0).toISOString(),format:"json",mimetype:"application/json",content:Array.from(e.values()),size:void 0,writable:!0,type:"directory"}}async _getServerContents(t,e){const n=a.PathExt.basename(t);let i=(await this._getServerDirectory(a.URLExt.join(t,".."))).get(n);if(!i)return null;if(i=i||{name:n,path:t,last_modified:new Date(0).toISOString(),created:new Date(0).toISOString(),format:"text",mimetype:"text/plain",type:"file",writable:!0,content:null},null==e?void 0:e.content)if("directory"===i.type){const e=await this._getServerDirectory(t);i={...i,content:Array.from(e.values())}}else{const e=a.URLExt.join(a.PageConfig.getBaseUrl(),"files",t),n=await fetch(e);if(!n.ok)return null;const o=i.mimetype||n.headers.get("Content-Type");i="notebook"===i.type||-1!==(null==o?void 0:o.indexOf("json"))||t.match(/\.(ipynb|[^/]*json[^/]*)$/)?{...i,content:await n.json(),format:"json",mimetype:i.mimetype||"application/json"}:-1!==o.indexOf("text")||c.has(o)?{...i,content:await n.text(),format:"text",mimetype:o||"text/plain"}:{...i,content:btoa(String.fromCharCode(...new Uint8Array(await n.arrayBuffer()))),format:"base64",mimetype:o||"octet/stream"}}return i}async _getServerDirectory(t){const e=this._serverContents.get(t)||new Map;if(!this._serverContents.has(t)){const n=a.URLExt.join(a.PageConfig.getBaseUrl(),"api/contents",t,"all.json");try{const t=await fetch(n),a=JSON.parse(await t.text());for(const t of a.content)e.set(t.name,t)}catch(t){console.warn(`don't worry, about ${t}... nothing's broken. if there had been a\n          file at ${n}, you might see some more files.`)}this._serverContents.set(t,e)}return e}async _incrementCounter(t){var e;const n=(null!==(e=await this._counters.getItem(t))&&void 0!==e?e:-1)+1;return await this._counters.setItem(t,n),n}}var m;!function(t){t.EMPTY_NB={metadata:{orig_nbformat:4},nbformat_minor:4,nbformat:4,cells:[]}}(m||(m={}));var p=n(18833),h=n(385),d=n(7103),f=n(44253),u=n(62889);const g={id:"@jupyterlite/server-extension:contents",autoStart:!0,provides:i,activate:t=>{const e=a.PageConfig.getOption("contentsStorageName");return new l({contentsStorageName:e})}},w={id:"@jupyterlite/server-extension:kernels",autoStart:!0,provides:p.IKernels,requires:[p.IKernelSpecs],activate:(t,e)=>new p.Kernels({kernelspecs:e})},y={id:"@jupyterlite/server-extension:kernelspec",autoStart:!0,provides:p.IKernelSpecs,activate:t=>new p.KernelSpecs({})},v={id:"@jupyterlite/server-extension:sessions",autoStart:!0,provides:d.ISessions,requires:[p.IKernels],activate:(t,e)=>new d.Sessions({kernels:e})},_=[g,w,y,{id:"@jupyterlite/server-extension:server",autoStart:!0,requires:[i,p.IKernels,p.IKernelSpecs,d.ISessions,f.ISettings,u.ITranslation],activate:(t,e,n,a,i,o,s)=>{const r=new h.JupyterServer({contents:e,kernels:n,kernelspecs:a,sessions:i,settings:o,translation:s}),c=new h.LiteServiceManager({server:r});t.registerServiceManager(c)}},v,{id:"@jupyterlite/server-extension:settings",autoStart:!0,provides:f.ISettings,activate:t=>{const e=a.PageConfig.getOption("settingsStorageName");return new f.Settings({settingsStorageName:e})}},{id:"@jupyterlite/server-extension:translation",autoStart:!0,provides:u.ITranslation,activate:t=>new u.Translation}]}}]);
//# sourceMappingURL=837.e8a92acb2a0b9cb2262f.js.map